#!/bin/sh

# Copyright (C) 2015 OpenWrt.org

# 0 yes blockdevice handles this - 1 no it is not there
blkdev=`dirname $DEVPATH`
basename=`basename $blkdev`
device=`basename $DEVPATH`
skip=`block info | sed 's/\(.*\): .*/\1/' | grep -q $device ; echo $?`
path=$DEVPATH

if [ $basename != "block" ] && [ -z "${device##sd*}" ] && [ $skip -eq 1 ]; then
        mntpnt=$device
        case "$ACTION" in
                add)
                        mkdir -p /mnt/usb/$mntpnt
                        chmod 777 /mnt/usb/$mntpnt
						ln -sf /tmp/usb/.run/mountd/$mntpnt /mnt/usb/$mntpnt
                ;;
                remove)
						rm -rf /mnt/usb/$mntpnt
                ;;
        esac
fi
